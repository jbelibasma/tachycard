Uluru.prototype.addIconAndTitle=function(){let e="";return e+='<div class="screen_icon"><img src="images/card.svg"></div>',e+='<div class="title">Nouvelle carte</div>','<div class="screen_icon"><img src="images/card.svg"></div><div class="title">Nouvelle carte</div>'},Uluru.prototype.initNewCardDiv=function(){let e="";return e=this.addParentDivToContent(e,"id = 'new_card'"),e=this.addParentDivToContent(e,"class='screen new_card'")},Uluru.prototype.initGenericDiv=function(e){let i="";return i=this.addParentDivToContent(i,"id = "+e),i=this.addParentDivToContent(i,"class='screen "+e+"'")},Uluru.prototype.cardTypeBuilder=function(){let e=this.addIconAndTitle();return e+='<form class="step card_type visible">',e+='<div class="subtitle">Type de prothèse</div>',e+='<div class="message">Choisissez le type de dispositif implanté</div>',e+='<div class="chooser">',e+='<div id="PMKDAIHOL" class="item" >Rythmique</div>',e+='<div id="STENT" class="item off">Coronaire</div>',e+='<div id="TAVICLIP" class="item">Valvulaire</div>',e+='<div id="FOPCIAFA" class="item">Occlusion</div>',e+="</div>",e+="</form>"},Uluru.prototype.findPatientBuilder=function(){let e=this.addIconAndTitle();return e+='<form class="step patient" id="form_find_patient">',e+='<div class="elements">',e+='<div class="new_patient">',e+='<div class="buttons">',e+='<button type="button" class="previous" onClick="uluru.newCardWorkflowRenderer(\'new_card\',uluru.newPatientMedecinBuilder(\'patient\'))">Nouveau patient</button>',e+="</div>",e+="</div>",e+='<div class="search_patient">',e+='<div class="subtitle">Recherche du patient</div>',e+='<div class="item">',e+="<label>Nom</label>",e+='<input type="text" name="search_nom" value="">',e+="</div>",e+='<div class="item">',e+="<label>Prénom</label>",e+='<input type="text" name="search_prenom" value="">',e+="</div>",e+='<div class="item">',e+="<label>Date de naissance</label>",e+='<input type="date" name="search_birth" value="">',e+="</div>",e+='<div class="buttons">',e+='<button type="submit">Rechercher</button>',e+="</div>",e+="</div>",e+="</div>",e+="</form>"},Uluru.prototype.listPatientsBuilder=function(){let e=this.addIconAndTitle();return e+='<div class="step liste_patients">',e+='<div class="subtitle">Liste des patients trouvés</div>',e+='<div class="liste"></div>',e+='<div class="buttons">',e+='<button type="button" class="previous" onclick="uluru.newCardWorkflowRenderer(\'new_card\',uluru.findPatientBuilder())">Nouvelle recherche</button>',e+='<button type="submit" class="previous" onclick="uluru.newCardWorkflowRenderer(\'new_card\',uluru.newPatientMedecinBuilder(\'patient\'))">Nouveau patient</button>',e+="</div>",e+="</div>"},Uluru.prototype.newPatientMedecinBuilder=function(e){let i="uluru.newCardWorkflowRenderer('new_card',uluru.findPatientBuilder())",t="du "+e,l="Patient",a=moment(Date.now()).format("YYYY-MM-DD");"medecin"===e&&(i="uluru.newCardWorkflowRenderer('new_card',uluru.listMedecinsBuilder(),uluru.findAllMedecins.bind(uluru))",t="de l'Opérateur",l="Opérateur");let n=this.addIconAndTitle();return n+='<form class="step new_'+e+'" id="form_new_'+e+'">',n+='<div class="subtitle">Nouveau '+l+"</div>",n+='<div class="message">Merci de remplir le formulaire</div>',n+='<div class="item">',n+="<label>Nom "+t+"</label>",n+='<input type="text" name="nom" value="" required>',n+="</div>",n+='<div class="item">',n+="<label>Prénom "+t+"</label>",n+='<input type="text" name="prenom" value="" required>',n+="</div>",n+='<div class="item">',n+="<label>Email</label>",n+='<input type="email" name="email" value="">',n+="</div>",n+='<div class="item">',n+="<label>Téléphone</label>",n+='<input type="tel" name="tel" value="">',n+="</div>","patient"===e&&(n+='<div class="item">',n+="<label>Date de naissance</label>",n+='<input type="date" name="date_naissance" value="" max="'+a+'" required>',n+="</div>",n+='<div class="item">',n+="<label>Sexe</label>",n+='<select name="sexe">',n+='<option value="Homme">Homme</option>',n+='<option value="Femme">Femme</option>',n+='<option value="Autre">Autre</option>',n+="</select>",n+="</div>",n+='<div class="item">',n+='<label for="user_mat_ab_id">Sonde abandonnée</label>',n+='<div class="elements input-message" style="display: flex">',n+='<div class="item">',n+='<input id="user_mat_ab_id" name="user_mat_ab" type="checkbox" style="width: auto" >',n+="</div>",n+='<div class="item">',n+="Le patient est-il porteur d'une sonde abandonnée ?",n+="</div>",n+="</div>",n+="</div>",this.record&&(n+='<div class="item">',n+='<label for="user_data_id">Données personnelles</label>',n+='<div class="elements input-message" style="display: flex">',n+='<div class="item">',n+='<input id="user_data_id" name="user_data" type="checkbox" style="width: auto" required>',n+="</div>",n+='<div class="item">',n+="En créant le compte de ce patient vous certifiez que ce dernier a bien été informé et accepte",n+=" sans ",n+="réserve cet enregistrement de ses données personnelles et les conditions annexes à cet",n+="enregistrement.",n+="</div>",n+="</div>",n+="</div>")),n+='<div class="buttons">',n+='<button type="button" class="previous" onclick="'+i+'">Annuler</button>',n+='<button type="submit">Créer le compte</button>',n+="</div>",n+="</form>"},Uluru.prototype.listMedecinsBuilder=function(){let e=this.addIconAndTitle();return e+='<div class="step liste_medecins">',e+='<div class="subtitle">Liste des opérateurs trouvés</div>',e+='<div class="liste"></div>',e+='<div class="buttons">',e+='<button type="button" class="previous" onclick="uluru.newCardWorkflowRenderer(\'new_card\',uluru.listPatientsBuilder(),uluru.findPatient.bind(uluru))">Précédent</button>',3===this.user.id_profile&&(e+='<button type="button" class="add_doctor" onclick="uluru.newCardWorkflowRenderer(\'new_card\',uluru.newPatientMedecinBuilder(\'medecin\'))">Ajouter un opérateur</button>\n'),e+="</div>",e+="</div>"},Uluru.prototype.newMedecinBuilder=function(){let e=this.addIconAndTitle();return e+='<form class="step new_medecin" id="form_new_medecin">',e+='<div class="subtitle">Nouvel Opérateur</div>',e+='<div class="message">Merci de remplir le formulaire</div>',e+='<div class="item">',e+="<label>Nom de l'opérateur</label>",e+='<input type="text" name="nom" value="" required>',e+="</div>",e+='<div class="item">',e+="<label>Prénom de l'opérateur</label>",e+='<input type="text" name="prenom" value="" required>',e+="</div>",e+='<div class="item">',e+="<label>Email</label>",e+='<input type="email" name="email" value="" required>',e+="</div>",e+='<div class="item">',e+="<label>Téléphone</label>",e+='<input type="tel" name="tel" value="">',e+="</div>",e+='<div class="buttons">',e+='<button type="button" class="previous" onClick="uluru.newCardWorkflowRenderer(\'new_card\',uluru.listMedecinsBuilder(),uluru.findAllMedecins.bind(uluru))">Annuler</button>',e+='<button type="submit">Créer le compte</button>',e+="</div>",e+="</form>"},Uluru.prototype.formBoitierSondeBuilder=function(e){let i=this.isBoitier(e),t=moment(Date.now()).format("YYYY-MM-DD"),l=this.data.carte.type_carte,a="de la "+e.slice(0,-1)+" ou passez à l'étape suivante",n=e.slice(0,-1)+" "+e.slice(-1),d="",s="",r={},o={optionsConnexionSonde:["","IS1","IS4","IS1/DF1","DF4","Autre"],optionsTypeSonde:["","OD","VD","VG"],optionsListeFabricant:["","Biotronik","Boston scientifique","Medtronic","Microport","St jude médical","Médico"]},u={};i?(this.logMessage(e,this.data.carte[e]),t=this.setTodayDate(e,t),o=this.setListOptions(o,l),a="du "+e,n=e,d="required",s="uluru.newCardWorkflowRenderer('new_card',uluru.listMedecinsBuilder(),uluru.findAllMedecins.bind(uluru))",r=this.getOldValueFromSondeBoitier(this.data.carte[e]),u=this.setListDisplay(u,r),"boitier1"===e&&(s="uluru.newCardWorkflowRenderer('new_card',uluru.formBoitierSondeBuilder('boitier'))"),"boitier2"===e&&(s="uluru.newCardWorkflowRenderer('new_card',uluru.formBoitierSondeBuilder('boitier1'))")):"sonde1"===e?(t=this.setTodayDate(e,t),r=this.getOldValueFromSondeBoitier(this.data.carte.sonde1),s="uluru.newCardWorkflowRenderer('new_card',uluru.formBoitierSondeBuilder('boitier'))"):"sonde2"===e?(t=this.setTodayDate(e,t),r=this.getOldValueFromSondeBoitier(this.data.carte.sonde2),s="uluru.newCardWorkflowRenderer('new_card',uluru.formBoitierSondeBuilder('sonde1'))"):(t=this.setTodayDate(e,t),r=this.getOldValueFromSondeBoitier(this.data.carte.sonde3),s="uluru.newCardWorkflowRenderer('new_card',uluru.formBoitierSondeBuilder('sonde2'))"),this.logMessage("LE CODE BAR VO",r);let c=this.addIconAndTitle();return c+='<form class="step '+e+'" id="form_'+e+'">',c+='<div class="subtitle">'+n+"</div>",c+='<div class="message">Scannez le code barre '+a+"</div>",c+='<div class="item">',c+="<label>Code barre</label>",c+='<input type="text" name="'+e+'_code" id="'+e+'_code" class="code" value="'+r.code_bar+'">',c+="</div>",c+='<div class="item">',c+="<label>Date d'implantation</label>",c+='<input type="date" name="'+e+'_date_implantation" value="'+t+'" max="'+t+'" min="1900-01-01" '+d+">",c+="</div>",c=i?this.boitierBuilder(c,e,l,o,r,u):this.sondeBuilder(c,e,o,r),c+='<div class="item">',c+="<label>Numéro de série</label>",c+='<input type="text" name="'+e+'_sn" '+d+' value="'+this.notUndefined(r.sn)+'">',c+="</div>",c+='<div class="item">',c+="<label>Fabricant</label>",c+='<select name="'+e+'_fabricant">',c+=this.generateOptionSelect(o.optionsListeFabricant,r.fabricant),c+="</select>",c+="</div>",c+='<div class="item">',c+="<label>Modèle</label>",c+='<input type="text" name="'+e+'_modele" '+d+' value="'+r.modele+'">',c+="</div>",c+='<div class="item">',c+="<label>Référence</label>",c+='<input type="text" name="'+e+'_ref" id="'+e+'_ref" class="code" value="'+r.ref+'">',c+="</div>",c+='<input type="hidden" name="'+e+'_ean" value="'+r.ean+'">',c+='<div class="buttons">',c+='<button type="button" class="previous" onclick='+s+">Précédent</button>","PMKDAIHOL"!==this.data.carte.type_carte?("boitier2"!==e&&(c+='<button id="OTHERS_add" type="button" class="next">Ajouter prothèse</button>'),c+='<button id="OTHERS_submit" type="button" class="next">Terminer</button>'):c+='<button id="PMKDAIHOL_submit" type="button" class="next">Suivant</button>',c+="</div>",c+="</form>"},Uluru.prototype.isBoitier=function(e){return"boitier"===e||"boitier1"===e||"boitier2"===e},Uluru.prototype.setListOptions=function(e,i){let t=[],l=[],a=[],n=[],d=[],s=[],r="";return"PMKDAIHOL"===i&&(d=["","Pacemaker","Défibrillateur","Holter SC"],a=["BAV1","BAV2","BAV3 paroxystique","BAV3 permanent","Maladie de l'oreillette","Bloc sino atrial","Pause sinusale","Pause significative","Bradycardie symptomatique","FA lente"],t=["TV","FV","Mort subite","Torsade de pointe","Cardiopathie ischémique","Cardiopathie dilatée non ischémique","Cardiopathie hypertrophique"],l=["","Prévention primaire","Prévention secondaire"],n=["Syncope","Fibrillation atriale"]),"TAVICLIP"===i&&(d=["","TAVI","CLIP","MELODY","TENDYNE"],s=["","Aortique","Mitrale","Tricuspide","Pulmonaire"],r="libre"),"FOPCIAFA"===i&&(d=["","Foramen Ovale Perméable","Communication InterAtriale","Auricule Gauche"],s=["","Aortique","Mitrale","Tricuspide","Pulmonaire"],r="libre"),e.optionsDef=t,e.optionsDef2=l,e.optionsPace=a,e.optionsHolter=n,e.optionsType=d,e.optionsPosition=s,e.optionsLibre=r,e},Uluru.prototype.setListDisplay=function(e,i){let t='style="display: none"',l='style="display: none"',a='style="display: none"',n=!1;return"Défibrillateur"===i.type&&(l="",n=!0),"Holter SC"===i.type&&(a="",n=!0),"Pacemaker"===i.type&&(t="",n=!0),n||(t=""),e.paceDisplay=t,e.defDisplay=l,e.holterDisplay=a,e},Uluru.prototype.setTodayDate=function(e,i){return this.data.carte[e].date_implantation&&(i=this.data.carte[e].date_implantation),i},Uluru.prototype.sondeBuilder=function(e,i,t,l){return e+='<div class="item">',e+="<label> Connexion </label>",e+='<select name="'+i+'_connexion">',e+=this.generateOptionSelect(t.optionsConnexionSonde,l.connexion),e+="</select>",e+="</div>",e+='<div class="item">',e+="<label>Type de sonde</label>",e+='<select name="'+i+'_type">',e+=this.generateOptionSelect(t.optionsTypeSonde,l.type),e+="</select>",e+="</div>"},Uluru.prototype.boitierBuilder=function(e,i,t,l,a,n){return e+='<div class="item">',e+="<label>Type</label>",e+='<select name="'+i+'_type" required>',e+=this.generateOptionSelect(l.optionsType,a.type),e+="</select>",e+="</div>",e+='<div class="item">',e+="<label>Indication</label>","libre"===l.optionsLibre?e+='<input id="boitier_indication_Pacemaker" name="'+i+'_indication" value="'+a.indication+'" autocomplete="off">':(e+='<div id="boitier_indication_Pacemaker_div" class="two-element-side-by-side" '+n.paceDisplay+">",e+='<div class="flex-grow">',e+='<input id="boitier_indication_Pacemaker" name="boitier_indication" list="boitier_indication_Pacemaker_dl" value="'+a.indication+'" autocomplete="off">',e+="</div>",e+='<div class="buttons noMargin">',e+='<button id="boitier_indication_Pacemaker_bt">▼</button>',e+="</div>",e+="</div>",e+='<datalist id="boitier_indication_Pacemaker_dl">',e+='<select id="boitier_indication_Pacemaker_select" multiple size=11 >',e+=this.generateOptionSelect(l.optionsPace),e+="</select>",e+="</datalist>",e+='<div id="boitier_indication_Holter_SC_div" class="two-element-side-by-side" '+n.holterDisplay+">",e+='<div class="flex-grow">',e+='<input id="boitier_indication_Holter_SC" name="boitier_indication" list="boitier_indication_Holter_SC_dl" value="'+a.indication+'" autocomplete="off">',e+="</div>",e+='<div class="buttons noMargin">',e+='<button id="boitier_indication_Holter_SC_bt">▼</button>',e+="</div>",e+="</div>",e+='<datalist id="boitier_indication_Holter_SC_dl">',e+='<select id="boitier_indication_Holter_SC_select" multiple size=11 >',e+=this.generateOptionSelect(l.optionsHolter),e+="</select>",e+="</datalist>",e+='<select id="boitier_indication_Défibrillateur_prevention" name="boitier_indication" '+n.defDisplay+">",e+=this.generateOptionSelect(l.optionsDef2,a.indication2),e+="</select>",e+='<div id="boitier_indication_Défibrillateur_div" class="two-element-side-by-side" '+n.defDisplay+">",e+='<div class="flex-grow">',e+='<input id="boitier_indication_Défibrillateur" name="boitier_indication" list="boitier_indication_Défibrillateur_dl" value="'+a.indication+'" autocomplete="off">',e+="</div>",e+="<div>",e+='<button id="boitier_indication_Défibrillateur_bt">▼</button>',e+="</div>",e+="</div>",e+='<datalist id="boitier_indication_Défibrillateur_dl">',e+='<select id="boitier_indication_Défibrillateur_select" multiple size=8 >',e+=this.generateOptionSelect(l.optionsDef),e+="</select>",e+="</datalist>"),e+="</div>","TAVICLIP"!==t&&"FOPCIAFA"!==t||(e+='<div class="item">',e+="<label>Position</label>",e+='<select name="'+i+'_position">',e+=this.generateOptionSelect(l.optionsPosition,a.position),e+="</select>",e+="</div>"),e},Uluru.prototype.resumeCardBuilder=function(){let e="uluru.newCardWorkflowRenderer('new_card',uluru.formBoitierSondeBuilder('sonde3'))";"PMKDAIHOL"!==this.data.carte.type_carte&&(e="uluru.loadStateOfFront()");let i=this.addIconAndTitle();return i+='<div class="step resume" id="resume">',i+='<div class="subtitle">Résumé</div>',i+='<div class="resume_data"></div>',i+='<div class="buttons">',i+='<button type="button" class="previous" onClick="'+e+'">Précédent</button>',this.record&&(i+='<button type="button" class="next record" onClick="uluru.recordCard()">Enregistrer la carte</button>'),i+='<button type="button" class="next" onClick="uluru.saveSelection();uluru.generateCarte()">Générer la carte</button>',i+='<button type="button" class="next" onClick="uluru.generateCR()">Générer le compte-rendu</button>',i+="</div>",i+="</div>"},Uluru.prototype.renderSondeBuilder=function(e,i){var t=new moment(i.date_implantation).format("DD/MM/YYYY");return e+="<div class='bloc materiel'>",e+="<div class='line'>",e+="<div class='item'><div class='value type'>SONDE "+i.type+"</div></div>",""!==i.ref&&(e+="<div class='item'><div class='label'>REF: </div><div class='value bold'>&nbsp;"+i.ref+"</div></div>"),e+="<div class='item'><div class='value bold'>"+i.fabricant.substring(0,25)+"</div> - <div class='value'>"+i.modele.split(" ")[0]+"</div></div>",e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>SN: </div><div class='value bold'>&nbsp;"+i.sn+"</div></div>",e+="<div class='item'><div class='label'>CNX: </div><div class='value'>&nbsp;"+i.connexion+"</div></div>",e+="<div class='item'><div class='label'>Date implantation: </div><div class='value bold'>&nbsp;"+t+"</div></div>",e+="</div>",e+="</div>"},Uluru.prototype.renderBoitierBuilder=function(e,i){var t=new moment(i.date_implantation).format("DD/MM/YYYY");let l=" - "+i.modele.replace("Défibrillateur cardiaque","");return l=(l=l.replace("Stimulateur cardiaque","")).replace("implantable",""),e+="<div class='bloc indication'>",e+="<div class='line'>",this.data.carte.indication&&" "!==this.data.carte.indication&&(e+="<div class='item'><div class='label'>Indication:</div><div class='value indication'>&nbsp;"+this.data.carte.indication+"</div>"),e+="</div>","TAVICLIP"===this.data.carte.type_carte&&""!==i.position&&(e+="<div class='item'><div class='label'>Position:</div><div class='value indication'>&nbsp;"+i.position+"</div>"),e+="</div>",e+="</div>",e+="</div>",e+="<div class='bloc materiel'>",e+="<div class='line'>",e+="<div class='item'><div class='value type'>"+i.type+"</div></div>",""!==i.ref&&(e+="<div class='item'><div class='label'>REF: </div><div class='value bold'>&nbsp;"+i.ref+"</div></div>"),""!==i.fabricant&&""!==l&&(e+="<div class='item'><div class='value bold'>"+i.fabricant.substring(0,25)+"</div>  <div class='value'>"+l.substring(0,30)+"</div></div>"),e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>SN: </div><div class='value bold'>&nbsp;"+i.sn+"</div></div>",e+="<div class='item'><div class='label'>Date implantation: </div><div class='value bold'>&nbsp;"+t+"</div></div>",e+="</div>",e+="</div>"},Uluru.prototype.renderBoitierCompteRenduBuilder=function(e,i){var t=new moment(i.date_implantation).format("DD/MM/YYYY");return e+="<div class='bloc materiel'>",e+="<div class='line'>",e+="<div class='item'><div class='value type'>"+i.type+"</div></div>",e+="<div class='item'><div class='label'>Fabricant: </div><div class='value'>"+i.fabricant+"</div></div>",e+="<div class='item'><div class='label'>Modèle: </div><div class='value'>"+i.modele.substring(0,50)+"</div></div>",e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>SN: </div><div class='value'>&nbsp;"+i.sn+"</div></div>",e+="<div class='item'><div class='label'>Date implantation: </div><div class='value'>&nbsp;"+t+"</div></div>",e+="<div class='item'><div class='label'>Référence: </div><div class='value'>&nbsp;"+i.ref+"</div></div>",e+="</div>",e+="</div>"};