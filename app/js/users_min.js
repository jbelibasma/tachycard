Uluru.prototype.loadUsersList=function(e){this.logMessage("LOAD USERS LIST");var t=function(){$("#list_users").html("Chargement en cours...<div class='loadBall'></div>")}.bind(this),s=function(e){this.logMessage(e),"OK"===e.status?e.result&&e.result.length>0?this.renderUsersList(e.result):$("#list_users").html("Aucun utilisateur trouvé"):(this.logError(e.message),notification.create({title:"Erreur",content:e.message}))}.bind(this),i=!1;e&&(i="search="+e),this.apiRequest("GET","users","list",i,t,s,!1)},Uluru.prototype.renderUsersList=function(e){this.logMessage("RENDER USERS LIST");$("#list_users").empty();var t=[];e.forEach(function(e){if(-1==t.indexOf(e.id)){t.push(e.id);var s="<div class='item row' id='user_"+e.id+"'>";s+="<div class='cell'>"+e.nom+"</div>",s+="<div class='cell'>"+e.prenom+"</div>",s+="<div class='cell'>"+e.email+"</div>",s+="<div class='cell'>"+e.tel+"</div>",s+="<div class='cell'>"+e.type+"</div>",s+="</div>",$("#list_users").append(s),$("#user_"+e.id).click(function(){this.renderUpdateUser(e,999)}.bind(this))}}.bind(this))},Uluru.prototype.recordUser=function(){this.logMessage("RECORD USER");var e=function(){this.showLoading()}.bind(this),t=function(e){this.logMessage(e),this.hideLoading(),"OK"===e.status?(notification.create({title:"Utilisateur créé",content:`L'utilisateur <strong>${e.result.realname}</strong> a été créé avec succès, son mot de passe est : <strong>${e.result.password}</strong>`,icon:"check.svg",keep:!0,close:!0}),document.getElementById("new_user_form").reset(),this.showScreen("users"),this.loadUsersList()):(this.logError(e.message),notification.create({title:"Erreur",content:e.message,icon:"error.svg"}))}.bind(this);const s=new FormData(document.getElementById("new_user_form"));this.apiRequest("POST","users","create",s,e,t,!1)},Uluru.prototype.recordUserDoctor=function(){this.logMessage("RECORD USER MEDECIN");var e=function(){this.showLoading()}.bind(this),t=function(e){this.logMessage(e),this.hideLoading(),"OK"===e.status?(notification.create({title:"Utilisateur créé",content:`L'utilisateur <strong>${e.result.realname}</strong> a été créé avec succès, son mot de passe est : <strong>${e.result.password}</strong>`,icon:"check.svg",keep:!0,close:!0}),document.getElementById("new_users_doctor").reset(),this.hideAllScreen(),this.goToStep("liste_medecins"),this.findAllMedecins()):(this.logError(e.message),notification.create({title:"Erreur",content:e.message,icon:"error.svg"}))}.bind(this);const s=new FormData(document.getElementById("new_users_doctor"));this.apiRequest("POST","users","create",s,e,t,!1)},Uluru.prototype.updateUser=function(){this.logMessage("UPDATE USER");var e=function(){this.showLoading()}.bind(this),t=function(e){this.logMessage(e),this.hideLoading(),"OK"===e.status?(notification.create({title:"Utilisateur modifié",content:e.message,icon:"check.svg",delay:2e3}),document.getElementById("update_user_form").reset(),this.loadStateOfFront()):(this.logError(e.message),notification.create({title:"Erreur",content:e.message,icon:"error.svg"}))}.bind(this);const s=new FormData(document.getElementById("update_user_form"));this.apiRequest("POST","users","update",s,e,t,!1)},Uluru.prototype.renderUpdateUser=function(e,t){this.logMessage("RENDER UPDATE USER",e);var s="#update_users";999!==t?this.newCardWorkflowRenderer("main",this.updateUserBuilder("Patient",e)):(this.saveStateOfFront("main",this.listAllUsersBuilder.bind(this),this.loadUsersList.bind(this)),this.newCardWorkflowRenderer("main",this.updateUser2Builder())),$(s+" input[name=id]").val(e.id),$(s+" input[name=nom]").val(e.nom),$(s+" input[name=prenom]").val(e.prenom),$(s+" input[name=email]").val(e.email),$(s+" input[name=tel]").val(e.tel),null!==e.sexe&&$(s+" select[name=sexe]").val(e.sexe),$(s+" input[name=user_mat_ab]").prop("checked",!!e.mat_abandonne),$(s+" input[name=pass1]").val(""),$(s+" input[name=pass2]").val(""),this.showScreen("update_users")},Uluru.prototype.deleteUser=function(e){if(this.logMessage("DELETE USER",e),!window.confirm("Souhaitez-vous supprimer cet utilisateur ?"))return!1;var t=function(e){this.hideLoading(),this.logMessage(e),"OK"===e.status?(notification.create({icon:"check.svg",title:"OK",content:"Utilisateur supprimé avec succès"}),this.loadStateOfFront()):(this.logError(e.message),notification.create({title:"Erreur",content:e.message}))}.bind(this);this.apiRequest("GET","users","delete","id="+e+"&destination="+$("#update_users input[name=destination]").val(),()=>{this.showLoading()},t,!1)};