Uluru.prototype.initCardsEvents=function(){this.logMessage("INIT CARDS EVENTS"),$("#find_card").submit(function(i){i.preventDefault(),this.logMessage("SUBMIT FIND CARD"),this.findCard()}.bind(this)),$("#form_indication").submit(function(i){i.preventDefault(),this.logMessage("SUBMIT FORM INDICATION"),this.data.carte.indication=$("#form_indication input[name=boitier_indication]").val(),this.logMessage("INDICATION",this.data.carte.indication),this.goToStep("boitier"),$("#boitier_code").focus()}.bind(this))},Uluru.prototype.resetCard=function(){this.logMessage("RESET CARD"),this.data.carte={indication:!1,type_carte:!1,boitier:{code_bar:!1,fabricant:!1,modele:!1,sn:!1,ean:!1,type:!1,date_implantation:!1,ref:!1,indication:!1,indication2:!1,position:!1},boitier1:{code_bar:!1,fabricant:!1,modele:!1,sn:!1,ean:!1,type:!1,date_implantation:!1,ref:!1,indication:!1,indication2:!1,position:!1},boitier2:{code_bar:!1,fabricant:!1,modele:!1,sn:!1,ean:!1,type:!1,date_implantation:!1,ref:!1,indication:!1,indication2:!1,position:!1},sonde1:{code_bar:!1,fabricant:!1,modele:!1,sn:!1,ean:!1,date_implantation:!1,connexion:!1,ref:!1},sonde2:{code_bar:!1,fabricant:!1,modele:!1,sn:!1,ean:!1,date_implantation:!1,connexion:!1,ref:!1},sonde3:{code_bar:!1,fabricant:!1,modele:!1,sn:!1,ean:!1,date_implantation:!1,connexion:!1,ref:!1},patient:!1,medecin:!1,centre:!1,patientSearch:{id:!1,search:!1},id:!1}},Uluru.prototype.hideNewCardForm=function(){this.logMessage("HIDE NEW CARD FORM"),$(".screen.new_carte").removeClass("visible")},Uluru.prototype.showNewCard=function(){this.logMessage("SHOW NEW CARD FORM"),this.initNewCardDivRenderer(),this.newCardWorkflowRenderer("new_card",this.cardTypeBuilder()),this.setNewCardEvents(),$(".screen.new_carte").addClass("visible"),$("#form_find_patient input[name='search']").focus()},Uluru.prototype.toggleSelectBoitier=function(i){let e=$("#form_boitier datalist[id=boitier_indication_"+i+"_dl]"),t=$("#form_boitier button[id=boitier_indication_"+i+"_bt]"),a=$("#form_boitier input[id=boitier_indication_"+i+"]"),r=document.getElementById("boitier_indication_"+i+"_select"),s=r.options;if(e.is(":visible"))this.hideSelectBoitier(i);else{e.show(),t.prop("value","Ã¢Â–Â²");for(var n=a.val(),d=0;d<s.length;d++)if(s[d].text===n){r.selectedIndex=d;break}}},Uluru.prototype.hideSelectBoitier=function(i){let e=$("#form_boitier button[id=boitier_indication_"+i+"_bt]");$("#form_boitier datalist[id=boitier_indication_"+i+"_dl]").hide(),e.prop("value","Ã¢Â–Â¼")},Uluru.prototype.fillInput=function(i){let e=document.getElementById("boitier_indication_"+i+"_select"),t=$("#form_boitier input[id=boitier_indication_"+i+"]"),a=e.options;t.val(a[e.selectedIndex].value),this.hideSelectBoitier(i)},Uluru.prototype.displaySelectBoitier=function(i){"Défibrillateur"===i&&($("#form_boitier div[id=boitier_indication_Pacemaker_div]").hide(),$("#form_boitier input[id=boitier_indication_Pacemaker]").prop("required",!1),$("#form_boitier div[id=boitier_indication_Holter_SC_div]").hide(),$("#form_boitier input[id=boitier_indication_Holter_SC]").prop("required",!1),$("#form_boitier div[id=boitier_indication_Défibrillateur_div]").show(),$("#form_boitier input[id=boitier_indication_Défibrillateur]").prop("required",!0),$("#form_boitier select[id=boitier_indication_Défibrillateur_prevention]").show(),$("#form_boitier select[id=boitier_indication_Défibrillateur_prevention]").prop("required",!0)),"Holter SC"===i&&($("#form_boitier div[id=boitier_indication_Défibrillateur_div]").hide(),$("#form_boitier input[id=boitier_indication_Défibrillateur]").prop("required",!1),$("#form_boitier select[id=boitier_indication_Défibrillateur_prevention]").hide(),$("#form_boitier select[id=boitier_indication_Défibrillateur_prevention]").prop("required",!1),$("#form_boitier div[id=boitier_indication_Pacemaker_div]").hide(),$("#form_boitier input[id=boitier_indication_Pacemaker]").prop("required",!1),$("#form_boitier div[id=boitier_indication_Holter_SC_div]").show(),$("#form_boitier input[id=boitier_indication_Holter_SC]").prop("required",!0)),"Holter SC"!==i&&"Défibrillateur"!==i&&($("#form_boitier div[id=boitier_indication_Défibrillateur_div]").hide(),$("#form_boitier input[id=boitier_indication_Défibrillateur]").prop("required",!1),$("#form_boitier select[id=boitier_indication_Défibrillateur_prevention]").hide(),$("#form_boitier select[id=boitier_indication_Défibrillateur_prevention]").prop("required",!1),$("#form_boitier div[id=boitier_indication_Pacemaker_div]").show(),$("#form_boitier input[id=boitier_indication_Pacemaker]").prop("required",!0),$("#form_boitier div[id=boitier_indication_Holter_SC_div]").hide(),$("#form_boitier input[id=boitier_indication_Holter_SC]").prop("required",!1))},Uluru.prototype.searchSN=function(i){this.logMessage("SEARCH CODE",i);var e=function(){this.showLoading()}.bind(this),t=function(e){if(this.hideLoading(),this.logMessage(e),"OK"===e.status)if(e.result){const t="fabricant : "+e.result.fabricant+"<br>modèle : "+e.result.modele+"<br>ArtIdCIO : "+e.result.ArtIdCIO+"<br>ArtLib1 : "+e.result.ArtLib1+"<br>ArtLib2 : "+e.result.ArtLib2+"<br>ArtTaille2 : "+e.result.ArtTaille2+"<br>Date Peremption : "+e.result.peremption+"<br>type : "+e.result.type+"<br>";notification.create({title:"Matériel trouvé",content:t,icon:"check.svg",delay:4e3,keep:!1,close:!0}),e.result.modele=e.result.modele.split(" ")[0],$("#form_"+i+" input[name='"+i+"_sn").val(e.result.sn),$("#form_"+i+" input[name='"+i+"_ean").val(e.result.ean),$("#form_"+i+" select[name='"+i+"_fabricant").val(e.result.fabricant),$("#form_"+i+" input[name='"+i+"_modele").val(e.result.modele),$("#form_"+i+" input[name='"+i+"_ref").val(e.result.ref),"boitier"===i?($("#form_"+i+" select[name='"+i+"_type").val(e.result.type),this.displaySelectBoitier(e.result.type)):$("#form_"+i+" select[name='"+i+"_connexion").val(e.result.connexion),this.greaterThanDateNow(e.result.peremption)&&alert("Materiel périmé"),$("#form_"+i+" input[name='"+i+"_date_implantation").focus()}else notification.create({title:"Matériel non trouvé",content:"Aucun matériel n'a été trouvé dans la base de données avec ce code barre",icon:"warning-orange.svg",delay:5e3});else notification.create({title:"Matériel non trouvé",content:"Aucun matériel n'a été trouvé dans la base de données avec ce code barre",icon:"warning-orange.svg",delay:5e3})}.bind(this),a="code="+$("#form_"+i+" input[name='"+i+"_code']").val();this.apiRequest("GET","materiel","get",a,e,t,!1)},Uluru.prototype.saveSelection=function(){let i=new FormData,e=0;for(let t in this.data.carte)if(this.data.carte[t].sn){let a={};a.reference=this.data.carte[t].ref,a.fabricant=this.data.carte[t].fabricant,a.modele=this.data.carte[t].modele,a.type=this.data.carte[t].type,i.append(""+e,JSON.stringify(a)),e++}var t=function(i){this.hideLoading(),this.logMessage(i),"OK"===i.status?i.result&&this.logMessage(i.result):this.logMessage("Erreur lors de la sauvegarde des données sélectionnées")}.bind(this);for(var a of i.entries())this.logMessage(a[0],a[1]);this.apiRequest("POST","selection","create",i,!1,t,!1)},Uluru.prototype.generateCarte=function(){if(this.logMessage("GENERATE CARTE"),$("#carte_print").remove(),$("body").addClass("print_card"),!this.data||!this.data.carte)return notification.create({icon:"error.svg",title:"Erreur",content:"Il manque des informations pour générer la carte"}),!1;if(!this.data.carte.boitier.sn)return notification.create({icon:"error.svg",title:"Erreur",content:"Le boitier n'est pas défini"}),!1;if(!this.data.carte.patient.prenom)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner le prénom du patient"}),!1;if(!this.data.carte.patient.nom)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner le nom du patient"}),!1;if(!this.data.carte.patient.date_naissance)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner la date de naissance nom du patient"}),!1;if(!this.data.carte.medecin.nom)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner le nom du médecin"}),!1;this.logMessage("OK, on a tout !"),$("body").append("<div id='carte_print'></div>"),$("#carte_print").append("<div class='content'></div>"),$("#carte_print").append("<div class='close'><img src='images/close.svg'></div>"),$("#carte_print .close").click(function(){$("#carte_print").remove(),$("body").removeClass("print_card")}),$("#carte_print").append("<button class='print_carte'>Imprimer</button>"),$("#carte_print button.print_carte").click(function(){window.print()});var i=new moment(this.data.carte.patient.date_naissance).format("DD/MM/YYYY");var e="";if(e+="<div class='bloc' style='text-align: center;font-weight: bolder'>",e+=this.getTitleOfCard(),e+="</div>",e+="<div class='bloc name'>",e+="<div class='line'>",e+="<div class='item'><div class='label'>Opérateur:</div><div class='value'>&nbsp;"+this.data.carte.medecin.nom+", "+this.data.carte.medecin.prenom+"</div></div>",e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>Nom: </div><div class='value bold'>&nbsp;"+this.data.carte.patient.nom+"</div><div class='label'>&nbsp;Prénom: </div><div class='value bold' > &nbsp;"+this.data.carte.patient.prenom+"</div></div>",this.data.carte.patient.sonde_abandonnee){e+="<div class='item'><div class='label'>Matériel abandonné:</div><div class='value'>&nbsp;"+(this.data.carte.patient.sonde_abandonnee?"Oui":"Non")+"</div></div>"}e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>Date de naissance: </div><div class='value' >&nbsp;"+i+"</div></div>",e+="</div>",e+="</div>",this.data.carte.boitier.sn&&(e=this.renderBoitierBuilder(e,this.data.carte.boitier)),this.data.carte.boitier1.sn&&(e=this.renderBoitierBuilder(e,this.data.carte.boitier1)),this.data.carte.boitier2.sn&&(e=this.renderBoitierBuilder(e,this.data.carte.boitier2)),this.data.carte.sonde1.sn&&(e=this.renderSondeBuilder(e,this.data.carte.sonde1)),this.data.carte.sonde2.sn&&(e=this.renderSondeBuilder(e,this.data.carte.sonde2)),this.data.carte.sonde3.sn&&(e=this.renderSondeBuilder(e,this.data.carte.sonde3)),$("#carte_print .content").html(e),$("#carte_print").addClass("visible")},Uluru.prototype.getTitleOfCard=function(){let i=this.data.carte.type_carte;!1!==i&&void 0!==i||(i="PMKDAIHOL");let e=this.data.carte.boitier.type,t={PMKDAIHOL:{Pacemaker:"Carte de porteur de stimulateur cardiaque","Défibrillateur":"Carte de porteur de défibrillateur cardiaque"},TAVICLIP:{TAVI:"Carte de porteur de TAVI",MELODY:"Carte de porteur de MELODY",TENDYNE:"Carte de porteur de TENDYNE",CLIP:"Carte de porteur de CLIP"},FOPCIAFA:{"Foramen Ovale Perméable":"Carte de porteur de FOP","Communication InterAtriale":"Carte de porteur de CIA","Auricule Gauche":"Carte de porteur de Auricule Gauche"}}[i][e];return void 0===t&&(t="Carte patient"),t},Uluru.prototype.getTitleOfMaterielCR=function(){let i=this.data.carte.type_carte;!1!==i&&void 0!==i||(i="PMKDAIHOL");return{PMKDAIHOL:"Relatif à la pose de stimulateur cardiaque",TAVICLIP:"Relatif à la pose d'une prothèse valvulaire",FOPCIAFA:"Relatif à la pose d'une prothèse de fermeture"}[i]},Uluru.prototype.generateCR=function(){if(this.logMessage("GENERATE CR"),$("#cr_print").remove(),$("body").addClass("print_cr"),!this.data||!this.data.carte)return notification.create({icon:"error.svg",title:"Erreur",content:"Il manque des informations pour générer la carte"}),!1;if(!this.data.carte.boitier.sn)return notification.create({icon:"error.svg",title:"Erreur",content:"Le boitier n'est pas défini"}),!1;if(!this.data.carte.patient.prenom)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner le prénom du patient"}),!1;if(!this.data.carte.patient.nom)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner le nom du patient"}),!1;if(!this.data.carte.patient.date_naissance)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner la date de naissance nom du patient"}),!1;if(!this.data.carte.medecin.nom)return notification.create({icon:"error.svg",title:"Erreur",content:"Merci de renseigner le nom du médecin"}),!1;this.logMessage("OK, on a tout !"),$("body").append("<div id='cr_print'></div>"),$("#cr_print").append("<div class='content'></div>"),$("#cr_print").append("<div class='close'><img src='images/close.svg'></div>"),$("#cr_print .close").click(function(){$("#cr_print").remove(),$("body").removeClass("print_cr")}),$("#cr_print").append("<button class='print_cr'>Imprimer</button>"),$("#cr_print button.print_cr").click(function(){window.print()});var i=new moment(this.data.carte.patient.date_naissance).format("DD/MM/YYYY");var e="";if(e+="<div class='bloc head'>",e+="<div class='logo'>TACHYCARD</div>",e+="<div class='title'><span class='bigger'>Rapport matériel</span><br>"+this.getTitleOfMaterielCR(),this.data.carte.id&&(e+="<br>Carte N°"+this.data.carte.id),e+="</div>",e+="</div>",e+="<div class='bloc patient'>",e+="<div class='subbloc patient'>",e+="<div class='bloc_title'>Patient</div>",e+="<div class='item'>",e+="<div class='label'>Nom / Prénom</div><div class='value'><span class='fontbold'>"+this.data.carte.patient.nom+"</span> / "+this.data.carte.patient.prenom+"</div>",e+="<div class='label'>Date de naissance</div><div class='value'>"+i+"</div>",e+="</div>",e+="</div>",e+="</div>",e+="<div class='bloc centre'>",e+="<div class='subbloc centre'>",e+="<div class='bloc_title'>Centre d'implantation</div>",e+="<div class='item'><div class='value'>",e+="<span class='fontbold'>"+this.data.carte.centre.name+"</span><br>",e+=this.data.carte.centre.adresse1+"<br>",e+=this.data.carte.centre.adresse2+"<br>",e+=this.data.carte.centre.adresse3+"<br>",e+=this.data.carte.centre.code_postal+" "+this.data.carte.centre.ville+"<br>",e+="</div>",e+="</div>",e+="</div>",e+="<div class='subbloc medecin'>",e+="<div class='bloc_title'>Opérateur implanteur</div>",e+="<div class='item'><div class='value'>Docteur "+this.data.carte.medecin.nom+", "+this.data.carte.medecin.prenom+"</div>",e+="</div>",e+="</div>",e+="<div class='subbloc indication'>",e+="<div class='bloc_title'>Indication</div>",e+="<div class='item'><div class='value'>"+this.data.carte.indication+"</div>",e+="</div>",e+="</div>",e+="</div>",e+="<div class='main_bloc_materiel'>",e+="<div class='col materiels'>",e+="<div class='title'>Matériel(s) implanté(s)</div>",this.data.carte.boitier.sn&&(e=this.renderBoitierCompteRenduBuilder(e,this.data.carte.boitier)),this.data.carte.boitier1.sn&&(e=this.renderBoitierCompteRenduBuilder(e,this.data.carte.boitier1)),this.data.carte.boitier2.sn&&(e=this.renderBoitierCompteRenduBuilder(e,this.data.carte.boitier2)),this.data.carte.sonde1.sn){var t=new moment(this.data.carte.sonde1.date_implantation).format("DD/MM/YYYY");e+="<div class='bloc materiel'>",e+="<div class='line'>",e+="<div class='item'><div class='value type'>SONDE "+this.data.carte.sonde1.type+"</div></div>",e+="<div class='item'><div class='label'>Fabricant: </div><div class='value'>"+this.data.carte.sonde1.fabricant+"</div></div>",e+="<div class='item'><div class='label'>Modèle: </div><div class='value'>"+this.data.carte.sonde1.modele.substring(0,50)+"</div></div>",e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>SN: </div><div class='value'>&nbsp;"+this.data.carte.sonde1.sn+"</div></div>",e+="<div class='item'><div class='label'>Connexion: </div><div class='value'>&nbsp;"+this.data.carte.sonde1.connexion+"</div></div>",e+="<div class='item'><div class='label'>Date implantation: </div><div class='value'>&nbsp;"+t+"</div></div>",e+="<div class='item'><div class='label'>Référence: </div><div class='value'>&nbsp;"+this.data.carte.sonde1.ref+"</div></div>",e+="</div>",e+="</div>"}if(this.data.carte.sonde2.sn){t=new moment(this.data.carte.sonde2.date_implantation).format("DD/MM/YYYY");e+="<div class='bloc materiel'>",e+="<div class='line'>",e+="<div class='item'><div class='value type'>SONDE "+this.data.carte.sonde2.type+"</div></div>",e+="<div class='item'><div class='label'>Fabricant: </div><div class='value'>"+this.data.carte.sonde2.fabricant+"</div></div>",e+="<div class='item'><div class='label'>Modèle: </div><div class='value'>"+this.data.carte.sonde2.modele.substring(0,50)+"</div></div>",e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>SN: </div><div class='value'>&nbsp;"+this.data.carte.sonde2.sn+"</div></div>",e+="<div class='item'><div class='label'>Connexion: </div><div class='value'>&nbsp;"+this.data.carte.sonde2.connexion+"</div></div>",e+="<div class='item'><div class='label'>Date implantation: </div><div class='value'>&nbsp;"+t+"</div></div>",e+="<div class='item'><div class='label'>Référence: </div><div class='value'>&nbsp;"+this.data.carte.sonde2.ref+"</div></div>",e+="</div>",e+="</div>"}if(this.data.carte.sonde3.sn){t=new moment(this.data.carte.sonde3.date_implantation).format("DD/MM/YYYY");e+="<div class='bloc materiel'>",e+="<div class='line'>",e+="<div class='item'><div class='value type'>SONDE "+this.data.carte.sonde3.type+"</div></div>",e+="<div class='item'><div class='label'>Fabricant: </div><div class='value'>"+this.data.carte.sonde3.fabricant+"</div></div>",e+="<div class='item'><div class='label'>Modèle: </div><div class='value'>"+this.data.carte.sonde3.modele.substring(0,50)+"</div></div>",e+="</div>",e+="<div class='line'>",e+="<div class='item'><div class='label'>SN: </div><div class='value'>&nbsp;"+this.data.carte.sonde3.sn+"</div></div>",e+="<div class='item'><div class='label'>Connexion: </div><div class='value'>&nbsp;"+this.data.carte.sonde3.connexion+"</div></div>",e+="<div class='item'><div class='label'>Date implantation: </div><div class='value'>&nbsp;"+t+"</div></div>",e+="<div class='item'><div class='label'>Référence: </div><div class='value'>&nbsp;"+this.data.carte.sonde3.ref+"</div></div>",e+="</div>",e+="</div>"}if(e+="</div>",e+="</div>",$("#cr_print .content").html(e),console.log(this),this.data.carte.id){this.data.carte.id}$("#cr_print").addClass("visible")},Uluru.prototype.recordCard=function(){this.logMessage("RECORD CARD"),this.data.carte.patient.id_users=this.user.id;var i=JSON.stringify(this.data),e=function(){this.showLoading()}.bind(this),t=function(i){this.hideLoading(),this.logMessage(i),"OK"===i.status?(notification.create({title:"Carte enregistrée",content:"La carte a été enregistrée avec succès",icon:"check.svg",delay:5e3}),this.data.carte.id=i.result.id,this.resumeCard(!1)):(this.logError(i.message),notification.create({title:"Erreur",content:i.message}),this.data.carte.id=!1)}.bind(this),a=new FormData;a.append("carte_data",i),this.apiRequest("POST","cartes","record",a,e,t,!1)},Uluru.prototype.findPatient=function(){this.logMessage("FIND PATIENT");var i=function(){this.showLoading()}.bind(this),e=function(i){this.logMessage(i),this.hideLoading(),"OK"===i.status?this.renderListePatients(i.result):(this.logError(i.message),notification.create({title:"Erreur",content:i.message}))}.bind(this);let t=null,a=null,r=this.data.carte.patientSearch;this.logMessage(r),r.id?(a=new FormData).append("id",r.id):r.search_nom||r.search_prenom?((a=new FormData).append("search_nom",r.search_nom),a.append("search_prenom",r.search_prenom),a.append("search_birth",r.search_birth)):(t=document.getElementById("form_find_patient"),a=new FormData(t),this.data.carte.patientSearch.search_nom=a.get("search_nom"),this.data.carte.patientSearch.search_prenom=a.get("search_prenom"),this.data.carte.patientSearch.search_birth=a.get("search_birth"),this.data.carte.patientSearch.id=!1),this.apiRequest("POST","users","find_patients",a,i,e,!1)},Uluru.prototype.findAllMedecins=function(){this.logMessage("FIND ALL MEDECINS");var i=function(){this.showLoading()}.bind(this),e=function(i){this.logMessage(i),this.hideLoading(),"OK"===i.status?this.renderListeMedecins(i.result):(this.logError(i.message),notification.create({title:"Erreur",content:i.message}))}.bind(this);this.apiRequest("GET","users","find_all_medecins",!1,i,e,!1)},Uluru.prototype.newMedecin=function(){this.logMessage("NEW MEDECIN");var i=function(){this.showLoading()}.bind(this),e=function(i){this.logMessage(i),this.hideLoading(),"OK"===i.status?(notification.create({title:"Opérateur créé",content:"L'opérateur a été créé avec succès"}),this.data.carte.medecin={id:i.result.id,nom:i.result.nom,prenom:i.result.prenom},this.newCardWorkflowRenderer("new_card",this.listMedecinsBuilder(),this.findAllMedecins.bind(this)),this.goToStep("boitier")):(this.logError(i.message),notification.create({title:"Erreur",content:i.message}))}.bind(this),t=document.getElementById("form_new_medecin"),a=new FormData(t);a.append("type","medecin"),this.apiRequest("POST","users","create",a,i,e,!1)},Uluru.prototype.newPatient=function(){this.logMessage("NEW PATIENT");var i=function(){this.showLoading()}.bind(this),e=function(i){this.logMessage(i),this.hideLoading(),"OK"===i.status?(notification.create({title:"Patient créé",content:"La patient a été créé avec succès"}),this.data.carte.patient={id:i.result.id,nom:i.result.nom,prenom:i.result.prenom,date_naissance:i.result.date_naissance},this.data.carte.patientSearch.id=i.result.id,this.data.carte.patientSearch.search=!1,this.newCardWorkflowRenderer("new_card",this.listMedecinsBuilder(),this.findAllMedecins.bind(this))):(this.logError(i.message),notification.create({title:"Erreur",content:i.message}))}.bind(this),t=document.getElementById("form_new_patient"),a=new FormData(t);this.record?this.apiRequest("POST","users","new_patient",a,i,e,!1):(this.data.carte.patient={nom:a.get("nom"),prenom:a.get("prenom"),date_naissance:a.get("date_naissance"),sonde_abandonnee:a.get("user_mat_ab")},this.newCardWorkflowRenderer("new_card",this.listMedecinsBuilder(),this.findAllMedecins.bind(this)))},Uluru.prototype.renderListePatients=function(i){this.logMessage("RENDER LIST PATIENTS",i);var e=[];this.newCardWorkflowRenderer("new_card",this.listPatientsBuilder()),i.forEach(function(i){if(-1==e.indexOf(i.id)){e.push(i.id);var t=moment(i.date_naissance).format("DD MMMM YYYY"),a="<div class='item patient' id='testDIv'>";a+="<div class='subItem flex-grow' id='pat_"+i.id+"'>",a+="<div class='cell nom'>"+i.nom+" <span class='prenom'> "+i.prenom+"</span><span class='date_naissance'> ( "+t+" )</span></div>",a+="</div>",a+="<div class='subItem' id='update_pat_"+i.id+"'>",a+="<span>Modifier</span>",a+="</div>",a+="</div>",$("#new_card .step.liste_patients .liste").append(a),$("#pat_"+i.id).click(function(){console.log("CLICK PATIENT ID",i.id),this.data.carte.patient={nom:i.nom,prenom:i.prenom,date_naissance:i.date_naissance,id:i.id},this.newCardWorkflowRenderer("new_card",this.listMedecinsBuilder(),this.findAllMedecins.bind(this))}.bind(this)),$("#update_pat_"+i.id).click(function(){console.log("CLICK UPDATE PATIENT",i.id),this.saveStateOfFront("new_card",this.listPatientsBuilder.bind(this),this.findPatient.bind(this)),this.renderUpdateUser(i,!0)}.bind(this))}}.bind(this))},Uluru.prototype.renderListeMedecins=function(i){this.logMessage("RENDER LIST MEDECINS",i);var e="#new_card .step.liste_medecins .liste";$(e).empty(),i.forEach(function(i){var t="<div class='item' id='med_"+i.id+"'>";t+="<div class='cell nom'>"+i.nom+" <span class='prenom'> "+i.prenom+"</span></div>",t+="</div>",$(e).append(t),$("#med_"+i.id).click(function(){console.log("CLICK MEDECIN ID",i.id),this.data.carte.medecin={nom:i.nom,prenom:i.prenom,id:i.id},this.data.carte.centre=i.centre,this.newCardWorkflowRenderer("new_card",this.formBoitierSondeBuilder("boitier")),$("#boitier_code").focus()}.bind(this))}.bind(this)),this.goToStep("liste_medecins")},Uluru.prototype.goToStep=function(i){this.logMessage("GO TO STEP",i),$("#new_carte .step").removeClass("visible"),$("#new_carte .step."+i).addClass("visible")},Uluru.prototype.resumeCard=function(i=!0){this.logMessage("RESUME CARD"),this.logMessage("RESUME",this.data);var e="";e+="<div class='line'>",e+="<div class='resume_bloc'>",e+="<div class='strong'>Patient</div>";var t=moment(this.data.carte.patient.date_naissance).format("DD/MM/YYYY");e+="<div>"+this.data.carte.patient.nom+"</div>",e+="<div>"+this.data.carte.patient.prenom+"</div>",e+="<div>"+t+"</div>",e+="</div>",e+="<div class='resume_bloc'>",e+="<div class='strong'>Opérateur</div>",e+="<div>"+this.data.carte.medecin.nom+"</div>",e+="<div>"+this.data.carte.medecin.prenom+"</div>",e+="</div>",e+="<div class='resume_bloc'>",e+="<div class='strong'>Indication</div>",e+="<div>"+this.data.carte.indication+"</div>",e+="</div>",e+="</div>",e+="<div class='line materiel'>",e+="<div class='resume_bloc'>",e+="<div class='strong'>"+this.data.carte.boitier.type+"</div>";var a=moment(this.data.carte.boitier.date_implantation).format("DD/MM/YYYY");if(e+="<div>"+this.data.carte.boitier.fabricant+"</div>",e+="<div>"+this.data.carte.boitier.modele.substring(0,50)+"</div>",e+="<div>"+this.data.carte.boitier.sn+"</div>",e+="<div>"+a+"</div>",e+="</div>",this.data.carte.boitier1.sn){e+="<div class='resume_bloc'>",e+="<div class='strong'>"+this.data.carte.boitier1.type+"</div>";var r=moment(this.data.carte.boitier1.date_implantation).format("DD/MM/YYYY");e+="<div>"+this.data.carte.boitier1.fabricant+"</div>",e+="<div>"+this.data.carte.boitier1.modele.substring(0,50)+"</div>",e+="<div>"+this.data.carte.boitier1.sn+"</div>",e+="<div>"+r+"</div>",e+="</div>"}if(this.data.carte.boitier2.sn){e+="<div class='resume_bloc'>",e+="<div class='strong'>"+this.data.carte.boitier2.type+"</div>";var s=moment(this.data.carte.boitier2.date_implantation).format("DD/MM/YYYY");e+="<div>"+this.data.carte.boitier2.fabricant+"</div>",e+="<div>"+this.data.carte.boitier2.modele.substring(0,50)+"</div>",e+="<div>"+this.data.carte.boitier2.sn+"</div>",e+="<div>"+s+"</div>",e+="</div>"}if(this.data.carte.sonde1.sn){var n=moment(this.data.carte.sonde1.date_implantation).format("DD/MM/YYYY");e+="<div class='resume_bloc'>",e+="<div class='strong'>Sonde "+this.data.carte.sonde1.type+"</div>",e+="<div>"+this.data.carte.sonde1.fabricant+"</div>",e+="<div>"+this.data.carte.sonde1.modele.substring(0,50)+"</div>",e+="<div>"+this.data.carte.sonde1.sn+"</div>",e+="<div>"+this.data.carte.sonde1.connexion+"</div>",e+="<div>"+n+"</div>",e+="</div>"}if(this.data.carte.sonde2.sn){var d=moment(this.data.carte.sonde2.date_implantation).format("DD/MM/YYYY");e+="<div class='resume_bloc'>",e+="<div class='strong'>Sonde "+this.data.carte.sonde2.type+"</div>",e+="<div>"+this.data.carte.sonde2.fabricant+"</div>",e+="<div>"+this.data.carte.sonde2.modele.substring(0,50)+"</div>",e+="<div>"+this.data.carte.sonde2.sn+"</div>",e+="<div>"+this.data.carte.sonde2.connexion+"</div>",e+="<div>"+d+"</div>",e+="</div>"}if(this.data.carte.sonde3.sn){var o=moment(this.data.carte.sonde3.date_implantation).format("DD/MM/YYYY");e+="<div class='resume_bloc'>",e+="<div class='strong'>Sonde "+this.data.carte.sonde3.type+"</div>",e+="<div>"+this.data.carte.sonde3.fabricant+"</div>",e+="<div>"+this.data.carte.sonde3.modele.substring(0,50)+"</div>",e+="<div>"+this.data.carte.sonde3.sn+"</div>",e+="<div>"+this.data.carte.sonde3.connexion+"</div>",e+="<div>"+o+"</div>",e+="</div>"}e+="</div>",$("#resume .resume_data").html(e),this.data.carte.id&&$("#resume .subtitle").html("Carte N°"+this.data.carte.id),i?($("#resume .buttons .previous").show(),$("#resume .buttons .record").show()):($("#resume .buttons .previous").hide(),$("#resume .buttons .record").hide())},Uluru.prototype.getOldValueFromSondeBoitier=function(i){let e={};for(const[t,a]of Object.entries(i))e[t]=a||"";return e},Uluru.prototype.notUndefined=function(i){return i||""};