Uluru.prototype.apiRequest=function(e,t,r,n,o,i,s){if(this.logMessage("API REQUEST"),"GET"!==e&&"POST"!==e)return this.logError("Méthode non valide"),!1;var a=this.api.url;this.api.use_token&&this.api.token&&(a+="/"+this.token),a+="/"+t+"/",r&&(a+=r+"/"),"GET"===e&&n&&(a+="?"+n),a=encodeURI(a),this.logMessage(a);var u=this;o&&o();var c=new XMLHttpRequest;c.timeout=12e4,c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE){if(200===c.status){u.offline=!1;try{var e=JSON.parse(c.responseText)}catch(e){return notification.create({title:"Erreur de données",content:"Les données retournées par le serveur sont erronées, contactez le support technique"}),this.hideLoading(),!1}return i(e),!0}if(0!==c.status){console.error("[API JS] La requête a retournée une erreur : "+c.status),this.hideLoading(),401==c.status&&uluru.unconnect(!0);try{var e=JSON.parse(c.responseText)}catch(e){console.error(e)}if("object"==typeof e&&e.message)var t=e.message;else t="Le serveur a retourné une erreur "+c.status+", contactez le support technique";return notification.create({title:"Erreur",content:t,icon:"error.svg"}),!1}}}.bind(this),c.ontimeout=function(e){if(console.error("[API JS] La requête a expirée"),!u.offline)return notification.create({title:"Erreur de connexion",content:"Désolé, le délai de réponse du serveur est dépassé. Vérifiez votre connexion internet et réessayez."}),u.offline=!0,!1}.bind(this),c.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;s&&s(t)}},c.onerror=function(e){if(console.error("[API JS] Erreur de connexion"),!u.offline)return notification.create({title:"Erreur de connexion",content:"Votre connexion semble interrompue. Vérifiez votre connexion internet et réessayez."}),u.offline=!0,!1}.bind(this),c.open(e,a,!0),c.send(n)};